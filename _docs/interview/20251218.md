20251218

17:00ï½18ï¼š00 ä½œä¸šå¸® æ‹‰æ–°ä¸šåŠ¡

è‡ªæˆ‘ä»‹ç»èŠé¡¹ç›®

ä¸ºä»€ä¹ˆé€‰æ‹©æ¢å·¥ä½œã€ä½œä¸šå¸®é‚£è¾¹æŠ€æœ¯æ ˆgolangå’Œphpä¸ºä¸»èƒ½ä¸èƒ½æ¥å—ã€å’Œä¹‹å‰åšçš„ä¸šåŠ¡ä¸ä¸€æ ·ã€å¯¹ä¸šåŠ¡æ„Ÿä¸æ„Ÿå…´è¶£

è´¢å¯ŒAlpha+å¹³å°æ•°æ®ä¾§

å¯¹æ‹›è¡ŒApp Cç«¯è¾“å‡ºåœºæ™¯ï¼ŒQPSå¤šå°‘

ä»‹ç»UIè‡ªåŠ¨åŒ–å¹³å°ã€å’Œç°æœ‰çš„UIè‡ªåŠ¨åŒ–æ¡†æ¶æœ‰ä»€ä¹ˆåŒºåˆ«

> å›ç­”å’ŒBrowserUseåšäº†å¯¹æ¯”ï¼š
>
> 1. å¯¹åŸºç¡€ç»„ä»¶è¿›è¡Œå°è£…ï¼Œç»„ä»¶é«˜åº¦å¤ç”¨ï¼Œå¯ä»¥é€šè¿‡æ‹–æ‹½çš„å½¢å¼å®ç°å¤æ‚å·¥ä½œæµï¼Œåœ¨åŸºç¡€ç»„ä»¶åŸºç¡€ä¸Šå°è£…å¸¸ç”¨ç»„ä»¶å¹¶å¤ç”¨ï¼›
> 2. BrowserUseæ‰§è¡Œæ¯”è¾ƒé»‘ç›’ï¼Œgooduiæ”¯æŒå·¥ä½œæµä¸­çš„å•ç»„ä»¶è°ƒè¯•ï¼Œå®ç°äº†AOPæ—¥å¿—å¢å¼ºï¼Œæ–¹ä¾¿è°ƒè¯•ï¼›
> 3. å‡†ç¡®æ€§æ–¹é¢ï¼šgooduié€šè¿‡DOMå‰ªæç®—æ³•ã€å¤šæ¨¡æ€è§†è§‰ç†è§£ã€RAGå¬å›é¢†åŸŸçŸ¥è¯†ç­‰æ–¹å¼ï¼Œåœ¨è‡ªç„¶è¯­è¨€è½¬è„šæœ¬å·¥ä½œæµã€AIå…ƒç´ å®šä½å‡†ç¡®ç‡ä¸Šï¼Œæ•ˆæœæ›´å¥½ï¼Œæ›´å‡†ç¡®ã€‚

å…«è‚¡æ–‡ï¼š

è¦†ç›–ç´¢å¼•å’Œéè¦†ç›–ç´¢å¼•

# Bæ ‘ã€B+æ ‘ã€äºŒå‰æ ‘åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©B+æ ‘

> ## ä¸€ã€åŸºæœ¬æ¦‚å¿µä¸ç»“æ„åŒºåˆ«
>
> ### 1. äºŒå‰æ ‘ï¼ˆBinary Treeï¼‰
>
> - **æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹**ï¼ˆå·¦ã€å³ï¼‰ã€‚
>
> - **æ™®é€šäºŒå‰æ ‘æ— åº**ï¼›è‹¥ä¸º**äºŒå‰æœç´¢æ ‘ï¼ˆBSTï¼‰**ï¼Œåˆ™æ»¡è¶³ï¼šå·¦å­æ ‘ < æ ¹ < å³å­æ ‘ã€‚
>
> - ç¼ºç‚¹
>
>   ï¼š
>
>   - æ’å…¥é¡ºåºå¯èƒ½å¯¼è‡´é€€åŒ–æˆé“¾è¡¨ï¼ˆå¦‚æ’å…¥æœ‰åºæ•°æ®ï¼‰ï¼ŒæŸ¥è¯¢æ•ˆç‡é€€åŒ–ä¸º O(n)ã€‚
>   - **é«˜åº¦ä¸å¯æ§**ï¼Œä¸é€‚åˆç£ç›˜ I/O ä¼˜åŒ–ã€‚
>
> > ğŸ“Œ ä¸€èˆ¬ä¸ç”¨äºæ•°æ®åº“ç´¢å¼•ã€‚
>
> ------
>
> ### 2. B æ ‘ï¼ˆBalanced Tree / B-Treeï¼‰
>
> - **å¤šè·¯å¹³è¡¡æŸ¥æ‰¾æ ‘**ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼ˆé€šå¸¸å‡ ååˆ°ä¸Šåƒï¼‰ã€‚
> - **æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨é”®å€¼å’Œæ•°æ®ï¼ˆè®°å½•ï¼‰**ã€‚
> - **å¶å­èŠ‚ç‚¹ä¸ä¸€å®šåœ¨åŒä¸€å±‚**ï¼ˆä½†å®é™…å®ç°ä¸­é€šå¸¸ä¿è¯å¹³è¡¡ï¼‰ã€‚
> - **æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œä½†æ•ˆç‡ä¸å¦‚ B+ æ ‘**ã€‚
>
> **ç‰¹ç‚¹**ï¼š
>
> - å†…éƒ¨èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹éƒ½å­˜æ•°æ®ã€‚
> - æŸ¥æ‰¾æ—¶å¯èƒ½åœ¨å†…éƒ¨èŠ‚ç‚¹å°±å‘½ä¸­æ•°æ®ï¼Œå‡å°‘ä¸€æ¬¡ I/Oï¼ˆç†è®ºä¸Šä¼˜åŠ¿ï¼‰ã€‚
>
> ------
>
> ### 3. B+ æ ‘ï¼ˆB Plus Treeï¼‰
>
> - æ˜¯ B æ ‘çš„å˜ç§ï¼Œ**åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨çœŸå®æ•°æ®ï¼ˆæˆ–æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆï¼‰**ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜ç´¢å¼•é”®ã€‚
> - **æ‰€æœ‰å¶å­èŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æ¥æˆä¸€ä¸ªæœ‰åºé“¾è¡¨**ã€‚
> - **æ‰€æœ‰æ•°æ®è®¿é—®å¿…é¡»èµ°åˆ°å¶å­èŠ‚ç‚¹**ã€‚
>
> **ç‰¹ç‚¹**ï¼š
>
> - æ›´é«˜çš„æ‰‡å‡ºï¼ˆå› ä¸ºå†…éƒ¨èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œå¯å®¹çº³æ›´å¤šé”®ï¼‰â†’ æ ‘æ›´çŸ® â†’ I/O æ›´å°‘ã€‚
> - èŒƒå›´æŸ¥è¯¢é«˜æ•ˆï¼ˆåªéœ€éå†å¶å­é“¾è¡¨ï¼‰ã€‚
> - å…¨å±€æœ‰åºï¼Œé€‚åˆæ’åºå’Œåˆ†é¡µã€‚
>
> ------
>
> ## äºŒã€å…³é”®åŒºåˆ«æ€»ç»“
>
> | ç‰¹æ€§             | äºŒå‰æ ‘          | B æ ‘              | B+ æ ‘                     |
> | ---------------- | --------------- | ----------------- | ------------------------- |
> | æ¯ä¸ªèŠ‚ç‚¹å­èŠ‚ç‚¹æ•° | â‰¤2              | å¤šï¼ˆå¦‚ 100~1000ï¼‰ | å¤šï¼ˆé€šå¸¸æ¯” B æ ‘æ›´é«˜æ‰‡å‡ºï¼‰ |
> | æ•°æ®å­˜å‚¨ä½ç½®     | æ‰€æœ‰èŠ‚ç‚¹        | æ‰€æœ‰èŠ‚ç‚¹          | **ä»…å¶å­èŠ‚ç‚¹**            |
> | å¶å­æ˜¯å¦é“¾å¼è¿æ¥ | å¦              | å¦                | **æ˜¯**                    |
> | èŒƒå›´æŸ¥è¯¢æ•ˆç‡     | å·®              | ä¸€èˆ¬              | **ä¼˜ç§€**                  |
> | æ ‘é«˜ï¼ˆI/O æ¬¡æ•°ï¼‰ | é«˜ï¼ˆæœ€å O(n)ï¼‰ | è¾ƒä½ï¼ˆlogâ‚˜Nï¼‰     | **æ›´ä½ï¼ˆå› æ‰‡å‡ºæ›´å¤§ï¼‰**    |
> | æ˜¯å¦é€‚åˆç£ç›˜å­˜å‚¨ | âŒ               | âœ…                 | âœ…âœ…ï¼ˆæ›´ä¼˜ï¼‰                |
>
> > æ³¨ï¼šm ä¸ºé˜¶æ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤§å­èŠ‚ç‚¹æ•°ï¼‰
>
> ------
>
> ## ä¸‰ã€MySQL ä¸ºä»€ä¹ˆé€‰æ‹© B+ æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿ
>
> MySQL çš„ InnoDB å­˜å‚¨å¼•æ“ä½¿ç”¨ **B+ æ ‘** ä½œä¸ºä¸»é”®ç´¢å¼•ï¼ˆèšç°‡ç´¢å¼•ï¼‰å’ŒäºŒçº§ç´¢å¼•çš„åº•å±‚ç»“æ„ï¼ŒåŸå› å¦‚ä¸‹ï¼š
>
> ### 1. **å‡å°‘ç£ç›˜ I/O æ¬¡æ•°**
>
> - ç£ç›˜è¯»å†™ä»¥â€œé¡µâ€ä¸ºå•ä½ï¼ˆInnoDB é»˜è®¤ 16KBï¼‰ã€‚
>
> - B+ æ ‘å†…éƒ¨èŠ‚ç‚¹åªå­˜é”®ï¼Œä¸å­˜æ•°æ® â†’ å•ä¸ªé¡µèƒ½å­˜æ›´å¤šé”® â†’
>
>    
>
>   æ ‘çš„é«˜åº¦æ›´ä½
>
>   ã€‚
>
>   - ä¾‹å¦‚ï¼š1 äº¿æ¡è®°å½•ï¼ŒB+ æ ‘é«˜åº¦é€šå¸¸ä¸º 3~4 å±‚ï¼Œåªéœ€ 3~4 æ¬¡ I/O å³å¯å®šä½æ•°æ®ã€‚
>
> ### 2. **é«˜æ•ˆæ”¯æŒèŒƒå›´æŸ¥è¯¢**
>
> - B+ æ ‘å¶å­èŠ‚ç‚¹å½¢æˆæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚
>
>    
>
>   ```
>   WHERE id BETWEEN 10 AND 100
>   ```
>
>   ï¼‰åªéœ€ï¼š
>
>   - å®šä½èµ·å§‹ç‚¹ï¼ˆO(log N)ï¼‰
>   - é¡ºåºéå†å¶å­èŠ‚ç‚¹ï¼ˆO(k)ï¼Œk ä¸ºç»“æœæ•°é‡ï¼‰
>
> - B æ ‘éœ€ä¸­åºéå†å¤šä¸ªåˆ†æ”¯ï¼Œæ•ˆç‡ä½ã€‚
>
> ### 3. **å…¨è¡¨æ‰«ææ›´é«˜æ•ˆ**
>
> - æ‰€æœ‰æ•°æ®é›†ä¸­åœ¨å¶å­å±‚ï¼Œä¸”è¿ç»­å­˜å‚¨ â†’ é¡ºåº I/Oï¼Œç¼“å­˜å‹å¥½ã€‚
> - B æ ‘æ•°æ®åˆ†æ•£åœ¨å„å±‚ï¼Œå…¨è¡¨æ‰«æéœ€éšæœºè®¿é—®å¤šä¸ªå±‚çº§ã€‚
>
> ### 4. **æ›´é€‚åˆæ•°æ®åº“çš„â€œå±€éƒ¨æ€§åŸç†â€**
>
> - æ•°æ®åº“æŸ¥è¯¢å¾€å¾€å…·æœ‰**æ—¶é—´å±€éƒ¨æ€§**å’Œ**ç©ºé—´å±€éƒ¨æ€§**ã€‚
> - B+ æ ‘çš„å¶å­é“¾è¡¨å¤©ç„¶æ”¯æŒé¡ºåºè®¿é—®ï¼Œæå‡ç¼“å­˜å‘½ä¸­ç‡ã€‚
>
> ### 5. **ç»Ÿä¸€çš„æŸ¥è¯¢è·¯å¾„**
>
> - æ‰€æœ‰æŸ¥è¯¢ï¼ˆæ— è®ºæ˜¯å¦å‘½ä¸­ï¼‰éƒ½å¿…é¡»èµ°åˆ°å¶å­èŠ‚ç‚¹ â†’ é€»è¾‘ç®€å•ã€ç¨³å®šã€‚
> - B æ ‘å¯èƒ½åœ¨å†…éƒ¨èŠ‚ç‚¹è¿”å›ç»“æœï¼Œå¯¼è‡´ä»£ç å¤æ‚åº¦å¢åŠ ã€‚
>
> ------
>
> ## å››ã€è¡¥å……è¯´æ˜
>
> - **MyISAM** å¼•æ“ä¹Ÿä½¿ç”¨ B+ æ ‘ï¼Œä½†å…¶ç´¢å¼•æ˜¯éèšç°‡çš„ï¼ˆå¶å­å­˜çš„æ˜¯æ•°æ®è¡ŒæŒ‡é’ˆï¼‰ã€‚
> - **InnoDB** çš„ä¸»é”®ç´¢å¼•æ˜¯**èšç°‡ç´¢å¼•**ï¼ˆå¶å­å­˜å®Œæ•´è¡Œæ•°æ®ï¼‰ï¼ŒäºŒçº§ç´¢å¼•å¶å­å­˜ä¸»é”®å€¼ã€‚
> - **å“ˆå¸Œç´¢å¼•**ï¼ˆå¦‚ Memory å¼•æ“ï¼‰é€‚åˆç­‰å€¼æŸ¥è¯¢ï¼Œä½†ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼Œæ•…ä¸ç”¨äºé€šç”¨åœºæ™¯ã€‚
>
> ------
>
> ## æ€»ç»“
>
> > **MySQL é€‰æ‹© B+ æ ‘ï¼Œæ˜¯å› ä¸ºå®ƒåœ¨ç£ç›˜ I/Oã€èŒƒå›´æŸ¥è¯¢ã€å…¨è¡¨æ‰«æå’Œå·¥ç¨‹å®ç°ä¸Šç»¼åˆè¡¨ç°æœ€ä¼˜ï¼Œç‰¹åˆ«é€‚åˆæ•°æ®åº“è¿™ç§ä»¥ç£ç›˜å­˜å‚¨ä¸ºä¸»ã€é¢‘ç¹è¿›è¡ŒèŒƒå›´æŸ¥è¯¢çš„åœºæ™¯ã€‚**
>
> å¦‚æœä½ æœ‰å…·ä½“åœºæ™¯ï¼ˆå¦‚é«˜å¹¶å‘ã€æµ·é‡æ•°æ®ã€SSD ç¯å¢ƒç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥è¿›ä¸€æ­¥è®¨è®ºæ˜¯å¦è¿˜æœ‰å…¶ä»–ç»“æ„ï¼ˆå¦‚ LSM-Treeï¼‰æ›´åˆé€‚ã€‚

å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢ã€æ€ä¹ˆè§£å†³

> ## ä¸€ã€å¦‚ä½•å®šä½æ…¢æŸ¥è¯¢
>
> ### 1. å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆSlow Query Logï¼‰
>
> è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚
>
> #### âœ… æ­¥éª¤ï¼š
>
> ```mysql
> -- æŸ¥çœ‹æ˜¯å¦å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—
> SHOW VARIABLES LIKE 'slow_query_log';
> 
> -- æŸ¥çœ‹æ…¢æŸ¥è¯¢é˜ˆå€¼ï¼ˆå•ä½ï¼šç§’ï¼‰
> SHOW VARIABLES LIKE 'long_query_time';
> 
> -- æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶è·¯å¾„
> SHOW VARIABLES LIKE 'slow_query_log_file';
> ```
>
> #### ğŸ”§ å¼€å¯æ–¹å¼ï¼ˆä¸´æ—¶æˆ–æ°¸ä¹…ï¼‰ï¼š
>
> - **ä¸´æ—¶å¼€å¯ï¼ˆé‡å¯å¤±æ•ˆï¼‰**ï¼š
>
>   ```mysql
>   SET GLOBAL slow_query_log = 'ON';
>   SET GLOBAL long_query_time = 1;  -- è¶…è¿‡1ç§’å³è®°å½•
>   SET GLOBAL log_queries_not_using_indexes = 'ON'; -- å¯é€‰ï¼šè®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢
>   ```
>
> - **æ°¸ä¹…å¼€å¯**ï¼šä¿®æ”¹ `my.cnf`ï¼ˆLinuxï¼‰æˆ– `my.ini`ï¼ˆWindowsï¼‰ï¼š
>
>   ```ini
>   [mysqld]
>   slow_query_log = 1
>   slow_query_log_file = /var/log/mysql/mysql-slow.log
>   long_query_time = 1
>   log_queries_not_using_indexes = 1
>   ```
>
> > âš ï¸ æ³¨æ„ï¼š`long_query_time` ç²¾ç¡®åˆ°å¾®ç§’ï¼Œä½†è®¾ç½®ä¸º 0 ä¼šè®°å½•æ‰€æœ‰æŸ¥è¯¢ï¼ˆæ…ç”¨ï¼‰ã€‚
>
> ------
>
> ### 2. ä½¿ç”¨ `EXPLAIN` åˆ†æ SQL æ‰§è¡Œè®¡åˆ’
>
> å¯¹å¯ç–‘ SQL ä½¿ç”¨ `EXPLAIN` æŸ¥çœ‹å…¶æ‰§è¡Œæ–¹å¼ï¼š
>
> ```mysql
> EXPLAIN SELECT * FROM users WHERE name = 'Alice';
> ```
>
> é‡ç‚¹å…³æ³¨å­—æ®µï¼š
>
> - **type**ï¼šè®¿é—®ç±»å‹ï¼ˆæœ€å¥½ä¸º `const`/`eq_ref`ï¼Œé¿å… `ALL` å…¨è¡¨æ‰«æï¼‰
> - **key**ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•
> - **rows**ï¼šé¢„ä¼°æ‰«æè¡Œæ•°ï¼ˆè¶Šå°è¶Šå¥½ï¼‰
> - **Extra**ï¼šæ˜¯å¦æœ‰ `Using filesort`ã€`Using temporary` ç­‰æ€§èƒ½æ€æ‰‹
>
> > ğŸ’¡ `EXPLAIN ANALYZE`ï¼ˆMySQL 8.0+ï¼‰å¯æ˜¾ç¤ºå®é™…æ‰§è¡Œæ—¶é—´å’Œèµ„æºæ¶ˆè€—ã€‚
>
> ------
>
> ### 3. ä½¿ç”¨ `SHOW PROCESSLIST` æŸ¥çœ‹å½“å‰è¿è¡Œçš„æ…¢ SQL
>
> ```mysql
> SHOW FULL PROCESSLIST;
> ```
>
> - å¯å®æ—¶çœ‹åˆ°æ­£åœ¨æ‰§è¡Œçš„ SQL åŠå…¶çŠ¶æ€ï¼ˆå¦‚ `Sending data`, `Copying to tmp table`ï¼‰ã€‚
> - ç»“åˆ `Time` åˆ—åˆ¤æ–­æ˜¯å¦å¡ä½ã€‚
>
> ------
>
> ### 4. ä½¿ç”¨æ€§èƒ½ç›‘æ§å·¥å…·
>
> - pt-query-digest
>
>   ï¼ˆPercona Toolkitï¼‰ï¼šåˆ†ææ…¢æ—¥å¿—ï¼Œç”Ÿæˆ Top N æ…¢ SQL æŠ¥å‘Šã€‚
>
>   ```bash
>   pt-query-digest /var/log/mysql/mysql-slow.log > slow_report.txt
>   ```
>
> - **MySQL Enterprise Monitor**ã€**Prometheus + Grafana + mysqld_exporter**
>
> - **äº‘æ•°æ®åº“æ§åˆ¶å°**ï¼ˆå¦‚é˜¿é‡Œäº‘ RDSã€è…¾è®¯äº‘ CDBï¼‰è‡ªå¸¦æ…¢ SQL åˆ†æåŠŸèƒ½ã€‚
>
> ------
>
> ## äºŒã€å¦‚ä½•ä¼˜åŒ–æ…¢æŸ¥è¯¢
>
> ### 1. æ·»åŠ åˆé€‚çš„ç´¢å¼•
>
> - **ç­‰å€¼æŸ¥è¯¢** â†’ å•åˆ—æˆ–è”åˆç´¢å¼•
> - **èŒƒå›´æŸ¥è¯¢** â†’ èŒƒå›´å­—æ®µæ”¾è”åˆç´¢å¼•æœ€å
> - **ORDER BY / GROUP BY** â†’ è¦†ç›–æ’åºå­—æ®µ
> - **é¿å…ç´¢å¼•å¤±æ•ˆ**ï¼šå¦‚å¯¹å­—æ®µä½¿ç”¨å‡½æ•°ã€éšå¼ç±»å‹è½¬æ¢ã€`LIKE '%xx'` å‰å¯¼é€šé…ç¬¦
>
> âœ… ç¤ºä¾‹ï¼š
>
> ```sql
> -- æŸ¥è¯¢ï¼šSELECT * FROM orders WHERE user_id = 100 AND status = 'paid' ORDER BY create_time;
> -- æ¨èç´¢å¼•ï¼š
> ALTER TABLE orders ADD INDEX idx_user_status_time (user_id, status, create_time);
> ```
>
> > ğŸ“Œ ä½¿ç”¨ **è¦†ç›–ç´¢å¼•**ï¼ˆCovering Indexï¼‰é¿å…å›è¡¨ï¼š`SELECT` å­—æ®µå…¨éƒ¨åŒ…å«åœ¨ç´¢å¼•ä¸­ã€‚
>
> ------
>
> ### 2. é‡å†™ä½æ•ˆ SQL
>
> - é¿å… `SELECT *`ï¼ŒåªæŸ¥å¿…è¦å­—æ®µ
> - æ‹†åˆ†å¤æ‚æŸ¥è¯¢ï¼ˆå¦‚å¤§ `JOIN` æˆ–å­æŸ¥è¯¢ï¼‰
> - ç”¨ `EXISTS` æ›¿ä»£ `IN`ï¼ˆå½“å­æŸ¥è¯¢ç»“æœå¤§æ—¶ï¼‰
> - é¿å…åœ¨ `WHERE` ä¸­å¯¹å­—æ®µåšè¿ç®—ï¼š
>   âŒ `WHERE YEAR(create_time) = 2024`
>   âœ… `WHERE create_time BETWEEN '2024-01-01' AND '2024-12-31'`
>
> ------
>
> ### 3. ä¼˜åŒ–è¡¨ç»“æ„ä¸æ•°æ®
>
> - åˆç†é€‰æ‹©å­—æ®µç±»å‹ï¼ˆå¦‚ç”¨ `INT` ä»£æ›¿ `VARCHAR` å­˜ IDï¼‰
> - ä½¿ç”¨ `NOT NULL` å‡å°‘å­˜å‚¨å¼€é”€
> - å¤§è¡¨è€ƒè™‘**åˆ†åº“åˆ†è¡¨**æˆ–**å½’æ¡£å†å²æ•°æ®**
> - å®šæœŸæ‰§è¡Œ `ANALYZE TABLE` æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå¸®åŠ©ä¼˜åŒ–å™¨é€‰æ‹©æ­£ç¡®æ‰§è¡Œè®¡åˆ’
>
> ------
>
> ### 4. è°ƒæ•´ MySQL é…ç½®å‚æ•°ï¼ˆè¿›é˜¶ï¼‰
>
> | å‚æ•°                                     | ä½œç”¨                                               |
> | ---------------------------------------- | -------------------------------------------------- |
> | `innodb_buffer_pool_size`                | ç¼“å­˜ InnoDB æ•°æ®å’Œç´¢å¼•ï¼Œå»ºè®®è®¾ä¸ºç‰©ç†å†…å­˜çš„ 50%~75% |
> | `sort_buffer_size`                       | æ¯ä¸ªçº¿ç¨‹ç”¨äº `ORDER BY` çš„å†…å­˜                     |
> | `join_buffer_size`                       | ç”¨äºæ— ç´¢å¼• JOIN çš„ç¼“å†²åŒº                           |
> | `tmp_table_size` / `max_heap_table_size` | æ§åˆ¶å†…å­˜ä¸´æ—¶è¡¨å¤§å°                                 |
>
> > âš ï¸ ä¿®æ”¹å‚æ•°éœ€è°¨æ…ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚
>
> ------
>
> ### 5. ä½¿ç”¨ç¼“å­˜å±‚
>
> - åº”ç”¨å±‚ç¼“å­˜ï¼ˆRedisã€Memcachedï¼‰ç¼“å­˜çƒ­ç‚¹æŸ¥è¯¢ç»“æœ
> - MySQL Query Cacheï¼ˆ**å·²åºŸå¼ƒ**ï¼Œ5.7 åé»˜è®¤å…³é—­ï¼Œ8.0 ç§»é™¤ï¼‰
>
> ------
>
> ## ä¸‰ã€ä¼˜åŒ–æµç¨‹æ€»ç»“ï¼ˆæœ€ä½³å®è·µï¼‰
>
> 1. **å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—**ï¼Œæ”¶é›†çœŸå®æ…¢ SQL
> 2. **ç”¨ `EXPLAIN` åˆ†æ**æ‰§è¡Œè®¡åˆ’ï¼Œè¯†åˆ«ç“¶é¢ˆï¼ˆå…¨è¡¨æ‰«æï¼Ÿä¸´æ—¶è¡¨ï¼Ÿæ–‡ä»¶æ’åºï¼Ÿï¼‰
> 3. **æ·»åŠ æˆ–è°ƒæ•´ç´¢å¼•**ï¼Œä¼˜å…ˆè§£å†³ I/O ç“¶é¢ˆ
> 4. **é‡å†™ SQL**ï¼Œé¿å…åæ¨¡å¼
> 5. **å‹æµ‹éªŒè¯**ä¼˜åŒ–æ•ˆæœï¼ˆå¦‚ç”¨ `sysbench` æˆ–ä¸šåŠ¡è„šæœ¬ï¼‰
> 6. **ç›‘æ§ä¸Šçº¿åæ€§èƒ½**ï¼Œå½¢æˆé—­ç¯
>
> ------
>
> ## å››ã€å¸¸è§æ…¢æŸ¥è¯¢åœºæ™¯ & è§£æ³•é€ŸæŸ¥
>
> | åœºæ™¯                          | é—®é¢˜                       | ä¼˜åŒ–æ–¹æ¡ˆ                                      |
> | ----------------------------- | -------------------------- | --------------------------------------------- |
> | `ORDER BY RAND()`             | å…¨è¡¨æ‰«æ + æ’åº            | æ”¹ç”¨ä¸»é”®éšæœºé‡‡æ ·                              |
> | å¤§åç§»åˆ†é¡µ `LIMIT 100000, 10` | æ‰«æå‰ 100010 è¡Œ           | æ”¹ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆ`WHERE id > last_id LIMIT 10`ï¼‰ |
> | å¤šè¡¨ JOIN æ— ç´¢å¼•              | ç¬›å¡å°”ç§¯çˆ†ç‚¸               | ä¸ºå…³è”å­—æ®µåŠ ç´¢å¼•                              |
> | `GROUP BY` æ— ç´¢å¼•             | Using temporary + filesort | ä¸ºåˆ†ç»„å­—æ®µå»ºç´¢å¼•                              |
>
> ------
>
> ## æ€»ç»“
>
> > **å®šä½é æ—¥å¿— + EXPLAINï¼Œä¼˜åŒ–é ç´¢å¼• + SQL é‡æ„ + æ¶æ„è°ƒæ•´ã€‚**
> >  æ…¢æŸ¥è¯¢ä¼˜åŒ–ä¸æ˜¯â€œé“¶å¼¹â€ï¼Œéœ€ç»“åˆä¸šåŠ¡é€»è¾‘ã€æ•°æ®è§„æ¨¡å’Œç¡¬ä»¶ç¯å¢ƒç»¼åˆæ–½ç­–ã€‚

# explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œè¿”å›çš„ç»“æœä¸­extraå­—æ®µè¿˜è®°ä¸è®°å¾—

> `EXPLAIN` æ˜¯ MySQL ä¸­ç”¨äºåˆ†æ SQL æ‰§è¡Œè®¡åˆ’çš„æ ¸å¿ƒå·¥å…·ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ MySQL **å¦‚ä½•æ‰§è¡Œä¸€æ¡æŸ¥è¯¢è¯­å¥**ï¼Œä»è€Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ€§èƒ½ç“¶é¢ˆï¼ˆå¦‚å…¨è¡¨æ‰«æã€ä¸´æ—¶è¡¨ã€æ–‡ä»¶æ’åºç­‰ï¼‰ã€‚
>
> ------
>
> ## ä¸€ã€`EXPLAIN` è¾“å‡ºå­—æ®µè¯¦è§£ï¼ˆå…±12ä¸ªå­—æ®µï¼‰
>
> æ‰§è¡Œï¼š
>
> ```mysql
> EXPLAIN SELECT * FROM users WHERE id = 1;
> ```
>
> è¾“å‡ºç¤ºä¾‹ï¼ˆä»¥ MySQL 8.0 ä¸ºä¾‹ï¼‰ï¼š
>
> | id   | select_type | table | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra |
> | ---- | ----------- | ----- | ---------- | ---- | ------------- | ---- | ------- | ---- | ---- | -------- | ----- |
> |      |             |       |            |      |               |      |         |      |      |          |       |
>
> ä¸‹é¢é€ä¸ªè§£é‡Šæ¯ä¸ªå­—æ®µçš„å«ä¹‰ï¼š
>
> ------
>
> ### 1. `id`
>
> - **æŸ¥è¯¢ä¸­ SELECT çš„åºåˆ—å·**ã€‚
> - å¦‚æœ SQL åŒ…å«å­æŸ¥è¯¢æˆ– UNIONï¼Œä¼šæœ‰å¤šä¸ª idã€‚
> - **id è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜**ï¼ˆå…ˆæ‰§è¡Œï¼‰ï¼›ç›¸åŒ id æŒ‰ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œã€‚
>
> > ç¤ºä¾‹ï¼š
> >
> > - ç®€å•æŸ¥è¯¢ï¼šid = 1
> > - å­æŸ¥è¯¢ï¼šå¤–å±‚ id=1ï¼Œå†…å±‚ id=2
> > - UNIONï¼šæ¯ä¸ª SELECT æœ‰ç‹¬ç«‹ id
>
> ------
>
> ### 2. `select_type`
>
> - **SELECT çš„ç±»å‹**ï¼Œå¸¸è§å€¼ï¼š
>
> | å€¼             | å«ä¹‰                                                |
> | -------------- | --------------------------------------------------- |
> | `SIMPLE`       | ç®€å•æŸ¥è¯¢ï¼ˆæ— å­æŸ¥è¯¢æˆ– UNIONï¼‰                        |
> | `PRIMARY`      | æœ€å¤–å±‚çš„ SELECT                                     |
> | `SUBQUERY`     | å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT                             |
> | `DERIVED`      | FROM å­å¥ä¸­çš„å­æŸ¥è¯¢ï¼ˆæ´¾ç”Ÿè¡¨ï¼‰ï¼ŒMySQL ä¼šç‰©åŒ–ä¸ºä¸´æ—¶è¡¨ |
> | `UNION`        | UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–ä¹‹åçš„ SELECT                     |
> | `UNION RESULT` | UNION çš„ç»“æœåˆå¹¶                                    |
>
> ------
>
> ### 3. `table`
>
> - **å½“å‰è®¿é—®çš„è¡¨å**ã€‚
> - å¦‚æœæ˜¯æ´¾ç”Ÿè¡¨ï¼ˆå¦‚ `(SELECT ...) AS tmp`ï¼‰ï¼Œä¼šæ˜¾ç¤º `<derivedN>`ï¼ŒN æ˜¯å­æŸ¥è¯¢çš„ idã€‚
>
> ------
>
> ### 4. `partitions`
>
> - **åŒ¹é…çš„åˆ†åŒº**ï¼ˆä»…å½“è¡¨ä½¿ç”¨åˆ†åŒºæ—¶æœ‰æ„ä¹‰ï¼‰ã€‚
> - è‹¥æœªåˆ†åŒºï¼Œæ˜¾ç¤º `NULL`ã€‚
>
> ------
>
> ### 5. `type` â­ï¼ˆ**æœ€é‡è¦ä¹‹ä¸€**ï¼‰
>
> - **è¿æ¥ç±»å‹ / è®¿é—®æ–¹æ³•**ï¼Œåæ˜ æŸ¥è¯¢æ•ˆç‡ï¼Œä»æœ€ä¼˜åˆ°æœ€å·®ï¼š
>
> | ç±»å‹              | è¯´æ˜                                                      | æ€§èƒ½     |
> | ----------------- | --------------------------------------------------------- | -------- |
> | `system`          | è¡¨åªæœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨ï¼‰ï¼Œå¯çœ‹ä½œ const çš„ç‰¹ä¾‹                 | âœ… æœ€ä¼˜   |
> | `const`           | é€šè¿‡ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ï¼Œæœ€å¤šè¿”å›ä¸€è¡Œï¼ˆå¦‚ `WHERE id = 1`ï¼‰ | âœ… æå¿«   |
> | `eq_ref`          | å¤šè¡¨ JOIN æ—¶ï¼Œä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•å…³è”ï¼ˆæ¯è¡ŒæŸ¥ä¸€æ¬¡ï¼‰        | âœ… é«˜æ•ˆ   |
> | `ref`             | ä½¿ç”¨éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ï¼ˆå¯èƒ½è¿”å›å¤šè¡Œï¼‰                        | âœ… è‰¯å¥½   |
> | `fulltext`        | å…¨æ–‡ç´¢å¼•æœç´¢                                              | ç‰¹å®šåœºæ™¯ |
> | `ref_or_null`     | ç±»ä¼¼ refï¼Œä½†é¢å¤–æœç´¢ NULL å€¼                              | è¾ƒå°‘ç”¨   |
> | `index_merge`     | ä½¿ç”¨ç´¢å¼•åˆå¹¶ä¼˜åŒ–ï¼ˆå¤šä¸ªç´¢å¼•ç»„åˆï¼‰                          | ä¸­ç­‰     |
> | `unique_subquery` | IN å­æŸ¥è¯¢ä¸­çš„å”¯ä¸€ç´¢å¼•ä¼˜åŒ–                                 | â€”        |
> | `index_subquery`  | IN å­æŸ¥è¯¢ä¸­çš„éå”¯ä¸€ç´¢å¼•                                   | â€”        |
> | `range`           | èŒƒå›´æ‰«æï¼ˆå¦‚ `BETWEEN`, `IN`, `>`, `<`ï¼‰                  | âš ï¸ å¯æ¥å— |
> | `index`           | å…¨ç´¢å¼•æ‰«æï¼ˆéå†æ•´ä¸ªç´¢å¼•æ ‘ï¼‰                              | âŒ è¾ƒæ…¢   |
> | `ALL`             | **å…¨è¡¨æ‰«æ**                                              | âŒ æœ€å·®   |
>
> > âœ… **ç›®æ ‡ï¼šå°½é‡è¾¾åˆ° `ref` æˆ–æ›´é«˜ï¼Œé¿å… `ALL` å’Œ `index`**
>
> ------
>
> ### 6. `possible_keys`
>
> - **å¯èƒ½ç”¨åˆ°çš„ç´¢å¼•åˆ—è¡¨**ï¼ˆåŸºäº WHERE æ¡ä»¶ï¼‰ã€‚
> - å¦‚æœä¸º `NULL`ï¼Œè¡¨ç¤ºæ²¡æœ‰å¯ç”¨ç´¢å¼• â†’ å¾ˆå¯èƒ½å…¨è¡¨æ‰«æã€‚
>
> ------
>
> ### 7. `key`
>
> - **å®é™…ä½¿ç”¨çš„ç´¢å¼•åç§°**ã€‚
> - å¦‚æœä¸º `NULL`ï¼Œè¡¨ç¤ºæœªä½¿ç”¨ç´¢å¼•ã€‚
>
> ------
>
> ### 8. `key_len`
>
> - **ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰**ã€‚
> - å¯ç”¨äºåˆ¤æ–­**è”åˆç´¢å¼•ä½¿ç”¨äº†å‡ åˆ—**ã€‚
>
> > ç¤ºä¾‹ï¼š
> >
> > - `INT` å  4 å­—èŠ‚ï¼Œ`VARCHAR(255)` utf8mb4 æœ€å¤š 1020 å­—èŠ‚ï¼ˆ255Ã—4ï¼‰+ é•¿åº¦å‰ç¼€
> > - è‹¥ `key_len = 4`ï¼Œè¯´æ˜åªç”¨äº†è”åˆç´¢å¼•çš„ç¬¬ä¸€åˆ—ï¼ˆå‡è®¾ç¬¬ä¸€åˆ—æ˜¯ INTï¼‰
>
> ------
>
> ### 9. `ref`
>
> - **ä¸ç´¢å¼•æ¯”è¾ƒçš„åˆ—æˆ–å¸¸é‡**ã€‚
> - æ˜¾ç¤ºå“ªäº›åˆ—æˆ–å€¼è¢«ç”¨äºç´¢å¼•æŸ¥æ‰¾ã€‚
>
> > ç¤ºä¾‹ï¼š
> >
> > - `const`ï¼šè¡¨ç¤ºç”¨å¸¸é‡ï¼ˆå¦‚ `WHERE id = 1`ï¼‰
> > - `db.table.column`ï¼šè¡¨ç¤ºç”¨å¦ä¸€å¼ è¡¨çš„åˆ—åš JOIN
>
> ------
>
> ### 10. `rows`
>
> - **é¢„ä¼°éœ€è¦æ‰«æçš„è¡Œæ•°**ï¼ˆåŸºäºç»Ÿè®¡ä¿¡æ¯ï¼‰ã€‚
> - **è¶Šå°è¶Šå¥½**ã€‚å¦‚æœæ¥è¿‘è¡¨æ€»è¡Œæ•°ï¼Œè¯´æ˜å¯èƒ½å…¨è¡¨æ‰«æã€‚
>
> > âš ï¸ æ³¨æ„ï¼šè¿™æ˜¯**ä¼°ç®—å€¼**ï¼Œä¸ä¸€å®šç²¾ç¡®ã€‚
>
> ------
>
> ### 11. `filtered`
>
> - **æŒ‰è¡¨æ¡ä»¶è¿‡æ»¤åï¼Œå‰©ä½™è¡Œçš„ç™¾åˆ†æ¯”**ï¼ˆMySQL 5.7+ï¼‰ã€‚
> - è¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„è¡Œä¸­ï¼Œæœ‰å¤šå°‘æ¯”ä¾‹æ»¡è¶³ WHERE æ¡ä»¶ã€‚
>
> > ç¤ºä¾‹ï¼š`filtered = 10.00` è¡¨ç¤º 10% çš„è¡Œæ»¡è¶³æ¡ä»¶ã€‚
>
> ------
>
> ### 12. `Extra` â­ï¼ˆ**æå…¶é‡è¦ï¼**ï¼‰
>
> - **é¢å¤–ä¿¡æ¯**ï¼ŒåŒ…å«å…³é”®æ€§èƒ½æç¤ºã€‚
> - å¸¸è§å€¼åŠå«ä¹‰å¦‚ä¸‹ï¼š
>
> ------
>
> ## äºŒã€`Extra` å­—æ®µè¯¦ç»†å«ä¹‰ï¼ˆé‡ç‚¹ï¼ï¼‰
>
> | å€¼                                      | å«ä¹‰                                                         | æ˜¯å¦éœ€è¦ä¼˜åŒ–     |
> | --------------------------------------- | ------------------------------------------------------------ | ---------------- |
> | **`Using index`**                       | **è¦†ç›–ç´¢å¼•**ï¼šæ‰€éœ€æ•°æ®å…¨éƒ¨æ¥è‡ªç´¢å¼•ï¼Œæ— éœ€å›è¡¨                 | âœ… ä¼˜ç§€           |
> | **`Using where`**                       | å­˜å‚¨å¼•æ“è¿”å›è¡Œåï¼ŒServer å±‚å†ç”¨ WHERE è¿‡æ»¤                   | æ­£å¸¸             |
> | **`Using index condition`**             | **ICPï¼ˆIndex Condition Pushdownï¼‰**ï¼šå°†éƒ¨åˆ† WHERE ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“è¿‡æ»¤ | âœ… ä¼˜åŒ–           |
> | **`Using temporary`**                   | **åˆ›å»ºä¸´æ—¶è¡¨**ï¼ˆå¦‚ GROUP BY æ— ç´¢å¼•ã€DISTINCTã€å¤æ‚ ORDER BYï¼‰ | âŒ ä¸¥é‡æ€§èƒ½é—®é¢˜   |
> | **`Using filesort`**                    | **æ— æ³•ç”¨ç´¢å¼•æ’åºï¼Œéœ€é¢å¤–æ’åº**ï¼ˆå†…å­˜æˆ–ç£ç›˜ï¼‰                 | âŒ é«˜é¢‘å‡ºç°éœ€ä¼˜åŒ– |
> | `Select tables optimized away`          | ä¼˜åŒ–å™¨ç›´æ¥ä»ç´¢å¼•è·å–ç»“æœï¼ˆå¦‚ `MIN()`/`MAX()`ï¼‰               | âœ… æä¼˜           |
> | `Impossible WHERE`                      | WHERE æ¡ä»¶æ’å‡ï¼Œæ— ç»“æœ                                       | æ­£å¸¸             |
> | `No matching min/max row`               | `MIN()`/`MAX()` æ— åŒ¹é…è¡Œ                                     | æ­£å¸¸             |
> | `Using join buffer (Block Nested Loop)` | JOIN æœªç”¨ç´¢å¼•ï¼Œä½¿ç”¨ join buffer                              | âŒ éœ€åŠ ç´¢å¼•       |
> | `Distinct`                              | ä¼˜åŒ– `DISTINCT` æ“ä½œï¼ˆæ‰¾åˆ°ç¬¬ä¸€åŒ¹é…å³åœæ­¢ï¼‰                   | æ­£å¸¸             |
>
> ------
>
> ### ğŸ” é‡ç‚¹å…³æ³¨çš„ `Extra` è­¦å‘Šé¡¹ï¼š
>
> #### 1. `Using filesort`
>
> - è¡¨ç¤º MySQL æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆ `ORDER BY`ï¼Œå¿…é¡»é¢å¤–æ’åºã€‚
> - **ä¼˜åŒ–æ–¹æ¡ˆ**ï¼šä¸º `ORDER BY` å­—æ®µæ·»åŠ ç´¢å¼•ï¼ˆæ³¨æ„è”åˆç´¢å¼•é¡ºåºï¼‰ã€‚
>
> #### 2. `Using temporary`
>
> - å‡ºç°åœ¨ `GROUP BY`ã€`DISTINCT`ã€`UNION` ç­‰åœºæ™¯ã€‚
>
> - ä¼˜åŒ–æ–¹æ¡ˆ
>
>   ï¼š
>
>   - ä¸ºåˆ†ç»„/æ’åºå­—æ®µå»ºç´¢å¼•
>   - é¿å… `SELECT *`ï¼Œåªé€‰å¿…è¦å­—æ®µ
>   - è°ƒæ•´ `tmp_table_size` å’Œ `max_heap_table_size`ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰
>
> ------
>
> ## ä¸‰ã€å®æˆ˜ç¤ºä¾‹åˆ†æ
>
> ### ç¤ºä¾‹ 1ï¼šå…¨è¡¨æ‰«æ + æ–‡ä»¶æ’åº
>
> ```mysql
> EXPLAIN SELECT name FROM users ORDER BY age;
> ```
>
> - `type: ALL`
> - `Extra: Using filesort`
> - **é—®é¢˜**ï¼šæ— ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æ + æ’åº
> - **ä¼˜åŒ–**ï¼š`ALTER TABLE users ADD INDEX idx_age (age);`
>
> ### ç¤ºä¾‹ 2ï¼šè¦†ç›–ç´¢å¼•ï¼ˆç†æƒ³æƒ…å†µï¼‰
>
> ```sql
> EXPLAIN SELECT user_id FROM orders WHERE status = 'paid';
> -- å‡è®¾ (status, user_id) æœ‰è”åˆç´¢å¼•
> ```
>
> - `type: ref`
> - `key: idx_status_user`
> - `Extra: Using index`
> - **è¯´æ˜**ï¼šæ— éœ€å›è¡¨ï¼Œé«˜æ•ˆï¼
>
> ------
>
> ## å››ã€è¡¥å……ï¼š`EXPLAIN FORMAT=JSON`ï¼ˆé«˜çº§ç”¨æ³•ï¼‰
>
> MySQL æ”¯æŒæ›´è¯¦ç»†çš„ JSON æ ¼å¼è¾“å‡ºï¼š
>
> ```sql
> EXPLAIN FORMAT=JSON SELECT ...;
> ```
>
> å¯çœ‹åˆ°ï¼š
>
> - æ¡ä»¶è¿‡æ»¤ç‡
> - æˆæœ¬ä¼°ç®—ï¼ˆcostï¼‰
> - æ˜¯å¦ä½¿ç”¨ MRRã€BNL ç­‰ä¼˜åŒ–
>
> é€‚åˆæ·±åº¦è°ƒä¼˜ã€‚
>
> ------
>
> ## æ€»ç»“
>
> | å…³é”®å­—æ®µ                | å…³æ³¨ç‚¹                                                 |
> | ----------------------- | ------------------------------------------------------ |
> | `type`                  | æ˜¯å¦å…¨è¡¨æ‰«æï¼ˆé¿å… `ALL`ï¼‰                             |
> | `key` / `possible_keys` | æ˜¯å¦å‘½ä¸­ç´¢å¼•                                           |
> | `rows`                  | æ‰«æè¡Œæ•°æ˜¯å¦åˆç†                                       |
> | `Extra`                 | **é‡ç‚¹çœ‹æ˜¯å¦æœ‰ `Using filesort` æˆ– `Using temporary`** |
>
> > ğŸ’¡ **ä¼˜åŒ–å£è¯€**ï¼š
> >  **â€œçœ‹ type é¿ ALLï¼ŒæŸ¥ key çœ‹å‘½ä¸­ï¼Œç›¯ Extra é˜² filesort/temporaryï¼Œç”¨è¦†ç›–ç´¢å¼•ææ€§èƒ½ã€‚â€**

# Redisä¸ºä»€ä¹ˆå¿«



# Redisé›†ç¾¤æ€ä¹ˆä¿è¯é«˜å¯ç”¨

> ### 1. **ä¸»ä»å¤åˆ¶ï¼ˆMaster-Slave Replicationï¼‰**
>
> - **æ•°æ®å†—ä½™**ï¼šæ¯ä¸ªä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼ˆSlaveï¼‰ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œå’Œæ•°æ®å¤‡ä»½ã€‚
> - **æ•…éšœè½¬ç§»**ï¼šå½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šè¢«æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚
>
> ### 2. **å“¨å…µæ¨¡å¼ï¼ˆSentinel Modeï¼‰**
>
> - **ç›‘æ§**ï¼šå“¨å…µï¼ˆSentinelï¼‰è¿›ç¨‹æŒç»­ç›‘æ§ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚
> - **é€šçŸ¥**ï¼šå½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå“¨å…µä¼šè‡ªåŠ¨è¿›è¡Œæ•…éšœæ£€æµ‹ï¼Œå¹¶é€šçŸ¥ç®¡ç†å‘˜æˆ–å…¶ä»–ç³»ç»Ÿã€‚
> - **æ•…éšœè½¬ç§»**ï¼šå“¨å…µä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°å…¶ä»–ä»èŠ‚ç‚¹çš„é…ç½®ï¼Œä½¿å…¶æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ã€‚
>
> ### 3. **é›†ç¾¤æ¨¡å¼ï¼ˆCluster Modeï¼‰**
>
> - **åˆ†ç‰‡**ï¼šRedis é›†ç¾¤å°†æ•°æ®åˆ†ç‰‡ï¼ˆshardingï¼‰åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†æ•°æ®ã€‚
> - **è‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼šé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸä¸å…¶ä»–èŠ‚ç‚¹é€šä¿¡ï¼Œæ£€æŸ¥å½¼æ­¤çš„å¥åº·çŠ¶æ€ã€‚å½“æŸä¸ªä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªä»èŠ‚ç‚¹æå‡ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿æ•°æ®çš„å¯ç”¨æ€§ã€‚
> - **ä¸€è‡´æ€§å“ˆå¸Œ**ï¼šRedis é›†ç¾¤ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æ¥åˆ†é…æ•°æ®ï¼Œç¡®ä¿æ•°æ®å‡åŒ€åˆ†å¸ƒï¼Œå¹¶åœ¨èŠ‚ç‚¹å¢å‡æ—¶æœ€å°åŒ–æ•°æ®è¿ç§»ã€‚
>
> ### 4. **å¿ƒè·³æœºåˆ¶**
>
> - **èŠ‚ç‚¹é—´é€šä¿¡**ï¼šé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå®šæœŸå‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œä»¥ç¡®è®¤å…¶ä»–èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ã€‚
> - **æ•…éšœæ£€æµ‹**ï¼šå¦‚æœæŸä¸ªèŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³æ¶ˆæ¯ï¼Œåˆ™è®¤ä¸ºè¯¥èŠ‚ç‚¹å·²ç»å¤±æ•ˆï¼Œå¹¶è§¦å‘æ•…éšœè½¬ç§»è¿‡ç¨‹ã€‚
>
> ### 5. **å‰¯æœ¬é›†ï¼ˆReplica Setï¼‰**
>
> - **æ•°æ®åŒæ­¥**ï¼šä»èŠ‚ç‚¹ä¼šå®šæœŸä»ä¸»èŠ‚ç‚¹åŒæ­¥æ•°æ®ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚
> - **è¯»å†™åˆ†ç¦»**ï¼šå®¢æˆ·ç«¯å¯ä»¥ä»ä»èŠ‚ç‚¹è¯»å–æ•°æ®ï¼Œå‡è½»ä¸»èŠ‚ç‚¹çš„è´Ÿè½½ï¼Œæé«˜ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚
>
> ### 6. **æŒä¹…åŒ–**
>
> - **RDB å’Œ AOF**ï¼šRedis æ”¯æŒä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼šRDBï¼ˆå¿«ç…§ï¼‰å’Œ AOFï¼ˆè¿½åŠ æ—¥å¿—ï¼‰ã€‚é€šè¿‡æŒä¹…åŒ–ï¼Œå³ä½¿åœ¨èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚
>
> ### 7. **å®¢æˆ·ç«¯é‡è¿æœºåˆ¶**
>
> - **è‡ªåŠ¨é‡è¿**ï¼šå½“å®¢æˆ·ç«¯ä¸ Redis èŠ‚ç‚¹æ–­å¼€è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å°è¯•é‡æ–°è¿æ¥ï¼Œç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§ã€‚
>
> ### 8. **é…ç½®ç®¡ç†**
>
> - **åŠ¨æ€é…ç½®**ï¼šRedis é›†ç¾¤æ”¯æŒåŠ¨æ€é…ç½®ç®¡ç†ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­æœåŠ¡çš„æƒ…å†µä¸‹è°ƒæ•´é›†ç¾¤é…ç½®ï¼Œå¦‚å¢åŠ æˆ–åˆ é™¤èŠ‚ç‚¹ã€‚
>
> é€šè¿‡ä»¥ä¸Šæœºåˆ¶ï¼ŒRedis é›†ç¾¤èƒ½å¤Ÿåœ¨èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œä¸­æ–­ç­‰æƒ…å†µä¸‹è‡ªåŠ¨æ¢å¤ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€‚

ç®—æ³•é¢˜ï¼š

```
è¿ç”¨æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ª  LRU (Least Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ 
   å®ç° GET å’Œ PUT æ–¹æ³•
```

å¦‚ä¸‹ï¼š

![image-20251218201104753](image-20251218201104753.png)

å†™å‡ºæ¥äº†æ²¡è·‘æµ‹è¯•ç”¨ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š

```java
import java.util.*;

class LRUCache {
    class Node {
        int key;
        int value;
        Node prev;
        Node next;
        public Node(int key, int value) {
            this.key = key;
            this.value = value;
        }
    }

    Map<Integer, Node> cache = new HashMap<>();
    int capacity;
    Node dummy = new Node(0, 0);

    public LRUCache(int capacity) {
        this.capacity = capacity;
        dummy.prev = dummy;
        dummy.next = dummy;
    }

    public Node get(int key) {
        Node node = getNode(key);
        return node;
    }

    public void put(int key, int value) {
        Node node = getNode(key);
        if(node == null) {
            Node newNode = new Node(key, value);
            cache.put(key, newNode);
            if(cache.size() > capacity) {
                removeNode(dummy.prev);
            }
        } else {
            node.value = value;
        }
    }

    public Node getNode(int key) {
        if(!cache.containsKey(key)) {
            return null;
        }
        Node node = cache.get(key);
        insertHead(node);
        return node;
    }

    private void insertHead(Node node) {
        Node temp = dummy.next;
        dummy.next = node;
        dummy.next.prev = node;
        node.prev = dummy;
        node.next = temp;
    }

    private void removeNode(Node node) {
        node.prev.next = node.next;
        node.next.prev = node.prev;
    }
}
```



https://leetcode.cn/problems/lru-cache/description/

```java
class LRUCache {
    private static class Node {
        int key, value;
        Node prev, next;

        Node(int k, int v) {
            key = k;
            value = v;
        }
    }

    private final int capacity;
    private final Node dummy = new Node(0, 0); // å“¨å…µèŠ‚ç‚¹
    private final Map<Integer, Node> keyToNode = new HashMap<>();

    public LRUCache(int capacity) {
        this.capacity = capacity;
        dummy.prev = dummy;
        dummy.next = dummy;
    }

    public int get(int key) {
        Node node = getNode(key); // getNode ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨
        return node != null ? node.value : -1;
    }

    public void put(int key, int value) {
        Node node = getNode(key); // getNode ä¼šæŠŠå¯¹åº”èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨
        if (node != null) { // æœ‰è¿™æœ¬ä¹¦
            node.value = value; // æ›´æ–° value
            return;
        }
        node = new Node(key, value); // æ–°ä¹¦
        keyToNode.put(key, node);
        pushFront(node); // æ”¾åˆ°æœ€ä¸Šé¢
        if (keyToNode.size() > capacity) { // ä¹¦å¤ªå¤šäº†
            Node backNode = dummy.prev;
            keyToNode.remove(backNode.key);
            remove(backNode); // å»æ‰æœ€åä¸€æœ¬ä¹¦
        }
    }

    // è·å– key å¯¹åº”çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æŠŠè¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨
    private Node getNode(int key) {
        if (!keyToNode.containsKey(key)) { // æ²¡æœ‰è¿™æœ¬ä¹¦
            return null;
        }
        Node node = keyToNode.get(key); // æœ‰è¿™æœ¬ä¹¦
        remove(node); // æŠŠè¿™æœ¬ä¹¦æŠ½å‡ºæ¥
        pushFront(node); // æ”¾åˆ°æœ€ä¸Šé¢
        return node;
    }

    // åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠ½å‡ºä¸€æœ¬ä¹¦ï¼‰
    private void remove(Node x) {
        x.prev.next = x.next;
        x.next.prev = x.prev;
    }

    // åœ¨é“¾è¡¨å¤´æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæŠŠä¸€æœ¬ä¹¦æ”¾åˆ°æœ€ä¸Šé¢ï¼‰
    private void pushFront(Node x) {
        x.prev = dummy;
        x.next = dummy.next;
        x.prev.next = x;
        x.next.prev = x;
    }
}

ä½œè€…ï¼šçµèŒ¶å±±è‰¾åºœ
é“¾æ¥ï¼šhttps://leetcode.cn/problems/lru-cache/solutions/2456294/tu-jie-yi-zhang-tu-miao-dong-lrupythonja-czgt/
æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚
```


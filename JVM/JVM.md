## OOM

### 1. 堆溢出

**java.lang.OutOfMemoryError: Java heap space**

* 原因：
    * 代码中可能存在大对象分配；
    * 可能存在内存泄漏，导致在多次GC之后，还是无法找到一块足够大的内存容纳当前对象；

* 解决方案：
    * 检查是否存在大对象的分配，很有可能是大数组分配 ；
    * 通过jmap命令，把堆内存dump下来，使用MAT等工具分析一下，检查是否存在内存泄漏的问题；
    * 如果没有找到明显的内存泄漏，使用 -Xmx 加大堆内存；



#### **2. 永久代（元空间）溢出**

**java.lang.OutOfMemoryError: Metaspace**

* 原因：
    * 运行期间生成了大量的代理类，导致方法区被撑爆，无法卸载
    * 元空间内存设置过小

* 解决方法：
    * 检查是否永久代空间或者元空间设置的过小；
    * 检查代码中是否存在大量的反射操作；
    * dump之后通过mat检查是否存在大量由于反射生成的代理类；

#### **3. 栈内存溢出**

**java.lang.OutOfMemoryError : unable to create new native Thread**

* 原因：出现这种异常，基本上都是创建了大量的线程导致的；

* 解决方法：
    * 减少线程数；
    * 缩小线程栈大小以创建更多线程；